import 'ecommerce.malloy'

-- Simple nested example
run: order_items -> {
  group_by: created_at.year
  aggregate: total_sales
  nest: by_month is {
    group_by: created_at.month
    aggregate: total_sales
  }
}

-- Pivot example
run: order_items -> {
  group_by: created_at.year
  aggregate: total_sales
  # pivot
  nest: by_month is {
    group_by: month_of_year is month(created_at)
    aggregate: total_sales
    where: month(created_at) >= 9
  }
}

